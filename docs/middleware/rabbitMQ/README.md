#### rabbitMQ如何实现消息幂等？

**1. MessageID检查：**

- 在数据库中创建一张unique key索引为唯一Message ID的表
- 在Producer客户端为每条消息设置唯一Message ID
- 在Consumer客户端根据唯一Message ID对消息进行幂等处理

**2. 为更新的数据设置前置条件（版本）：**


**3. 利用数据库的唯一约束实现幂等**


#### rabbitMQ出现消息堆积的情况怎么处理？

- 临时扩容，增加消费端，用硬件提升消费速度。
- 如果短时间内没有足够的服务器资源进行扩容，则将服务降级，关闭一些非核心业务，减少消息生产。
- 通过日志分析，监控等找到挤压原因，消息队列三部分，上游生产者是否异常生产大量消息，中游消息队列存储层是否出现问题，下游消费速度是否变慢，就能确定哪个环节出了问题
- 根据排查解决异常部分。
- 等待积压的消息被消费，恢复到正常状态，撤掉扩容服务器

>在队列数量没有变的情况下，单纯增加消费者数量是没有效果的。因为一个队列在同一时刻对于一个消费组来说是只会有一个消费者的，消费组中消费者再多也没意义。因此要么是在生产端把消息发往多个队列，达到并行消费的目的。要么是从该队列中取出消息，再将它分发个多个队列，从而达到并行消费的目的